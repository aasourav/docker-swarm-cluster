## Lock your swarm to protect its encryption key

The Raft logs used by swarm managers are encrypted on disk by default. This at-rest encryption protects your service's configuration and data from attackers who gain access to the encrypted Raft logs. One of the reasons this feature was introduced was in support of the Docker secrets feature.

When Docker restarts, both the TLS key used to encrypt communication among swarm nodes and the key used to encrypt and decrypt Raft logs on disk are loaded into each manager node's memory. Docker has the ability to protect the mutual TLS encryption key and the key used to encrypt and decrypt Raft logs at rest, by allowing you to take ownership of these keys and to require manual unlocking of your managers. This feature is called autolock.

When Docker restarts, you must unlock the swarm first, using a key encryption key generated by Docker when the swarm was locked. You can rotate this key encryption key at any time.

**Note: You don't need to unlock the swarm when a new node joins the swarm, because the key is propagated to it over mutual TLS.**
[References](https://docs.docker.com/engine/swarm/swarm_manager_locking/).\
When you initialize a new swarm, you can use the --autolock flag to enable autolocking of swarm manager nodes when Docker restarts.

`docker swarm init --autolock`

You will see something like key `SWMKEY-1-eQhCOqeNVcoFS6K+HUMO01+NKoHA2XhcRZ+f2y/+GfU`

```bash
sudo service docker restart
sudo docker service ls
```
To check docker service you have to unlock first.\
`docker swarm unlock`

Enable or disable autolock on an existing swarm.\
`docker swarm update --autolock=true`

`docker swarm update --autolock=false`

View the current unlock key for a running swarm.\
`docker swarm unlock-key`

Rotate the unlock key.\
`docker swarm unlock-key --rotate`


[References](https://docs.docker.com/engine/swarm/swarm_manager_locking/)


